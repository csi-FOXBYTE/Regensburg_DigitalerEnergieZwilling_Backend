@startuml
title Runtime-Flow: Public Delete

actor User
participant "Public Client" as client
participant "APISIX (Web/API Gateway)" as gateway
participant "Backend API" as api
participant "User Data Service" as uds
database "Database" as db

User -> client : Open delete link/QR
client -> gateway : GET /delete/{token}
gateway -> api : Forward request
api -> uds : validate token
uds -> db : lookup record
db --> uds : record or not found
uds --> api : valid/invalid
api --> gateway : show confirmation or error
gateway --> client : show confirmation or error

alt confirmed
  client -> gateway : POST /delete/{token}\naddress confirmation
  gateway -> api : Forward request
  api -> uds : delete request
  uds -> db : verify address\nand delete record
  db --> uds : deleted
  uds --> api : success
  api --> gateway : confirmation
  gateway --> client : confirmation
else invalid
  api --> gateway : error (token/address)
  gateway --> client : error (token/address)
end

@enduml
